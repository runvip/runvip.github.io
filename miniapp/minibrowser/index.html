<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Облегченный Просмотр Сайтов</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box; /* Учитываем padding в высоте */
        }
        .input-container {
            display: flex;
            margin-bottom: 10px;
            gap: 10px; /* Промежуток между элементами */
        }
        input[type="text"] {
            flex-grow: 1; /* Поле ввода занимает все доступное пространство */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            outline: none; /* Убираем стандартную обводку при фокусе */
        }
        input[type="text"]:focus {
            border-color: #007bff; /* Цвет обводки при фокусе */
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            white-space: nowrap; /* Чтобы текст кнопки не переносился */
        }
        button:hover {
            background-color: #0056b3;
        }
        iframe {
            flex-grow: 1; /* Iframe занимает оставшееся пространство */
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Стили для Telegram Mini Apps */
        body.telegram-mini-app {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }
        body.telegram-mini-app input[type="text"] {
            background-color: var(--tg-theme-secondary-bg-color);
            border-color: var(--tg-theme-hint-color);
            color: var(--tg-theme-text-color);
        }
        body.telegram-mini-app button {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }
    </style>
</head>
<body>
    <div class="input-container">
        <input type="text" id="urlInput" placeholder="Введите URL сайта (например, google.com)">
        <button id="openButton">Открыть</button>
    </div>
    <iframe id="contentFrame" srcdoc="&lt;p style='text-align:center;color:#666;padding-top:20px;'&gt;Введите URL и нажмите 'Открыть', чтобы просмотреть сайт через архив.&lt;/p&gt;"></iframe>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        console.log('Скрипт загружен и ожидает DOMContentLoaded.');

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded событие сработало. DOM готов к работе.');

            const urlInput = document.getElementById('urlInput');
            const openButton = document.getElementById('openButton');
            const contentFrame = document.getElementById('contentFrame');

            // Проверка, найдены ли элементы DOM
            if (!urlInput) {
                console.error('Ошибка: Элемент с ID "urlInput" не найден!');
            } else {
                console.log('Элемент "urlInput" успешно найден.');
            }
            if (!openButton) {
                console.error('Ошибка: Элемент с ID "openButton" не найден!');
            } else {
                console.log('Элемент "openButton" успешно найден.');
            }
            if (!contentFrame) {
                console.error('Ошибка: Элемент с ID "contentFrame" не найден!');
            } else {
                console.log('Элемент "contentFrame" успешно найден.');
            }

            // Инициализация Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                document.body.classList.add('telegram-mini-app');
                console.log('Telegram Web App инициализирован и класс "telegram-mini-app" добавлен к body.');
            } else {
                console.warn('Telegram Web App API (telegram-web-app.js) не обнаружен или еще не готов.');
            }

            // Функция для обработки URL с использованием archive.ph
            function openArchiveIS() {
                console.log('Функция openArchiveIS вызвана!');

                let url = urlInput.value.trim();

                if (!url) {
                    alert('Пожалуйста, введите URL.');
                    console.log('URL пустой, показано alert и функция завершена.');
                    return;
                }

                // Добавляем 'http://' или 'https://', если протокол отсутствует
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url; // Предпочитаем HTTPS
                    console.log('Протокол добавлен. Итоговый URL: ' + url);
                } else {
                    console.log('Протокол уже есть. Итоговый URL: ' + url);
                }

                // Формируем URL для archive.ph
                // archive.ph - один из доменов archive.is
                // Параметр "submit/" указывает на запрос архивации,
                // затем он перенаправит на заархивированную страницу.
                const archiveUrl = `https://archive.ph/submit/?url=${encodeURIComponent(url)}`;
                console.log('Будет загружен URL в iframe (archive.ph): ' + archiveUrl);

                contentFrame.src = archiveUrl;
            }

            // Обработчик события для кнопки
            if (openButton) {
                openButton.addEventListener('click', () => {
                    console.log('Кнопка "Открыть" нажата! Вызываю openArchiveIS().');
                    openArchiveIS();
                });
            } else {
                console.error('Не могу добавить обработчик клика, "openButton" не найден!');
            }

            // Обработчик события для нажатия Enter в поле ввода
            if (urlInput) {
                urlInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        console.log('Нажата Enter в поле ввода! Вызываю openArchiveIS().');
                        openArchiveIS();
                    }
                });
            } else {
                console.error('Не могу добавить обработчик keypress, "urlInput" не найден!');
            }
        });
    </script>
</body>
</html>
